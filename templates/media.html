{% extends 'layout.html' %}


{% block content %}
<div id="media-management" class="container">
  <table class="table table-striped" id="streams" data-csrf="{{csrf_tokens.streams}}">
    <caption>Streams</caption>
    <thead><tr>
        <th class="title">Title</th>
        <th class="prefix">Prefix</th>
        <th class="marlin_la_url">Marlin SAS URL</th>
        <th class="playready_la_url">PlayReady LA_URL</th>
        <th />
    </tr></thead>
  <tbody>
    {% for stream in streams %}
    <tr>
      <td class="title">{{stream.title}}</td>
      <td class="prefix">{{stream.prefix}}</td>
      <td class="marlin_la_url">{{stream.marlin_la_url|default(drm.marlin.laurl)}}</td>
      <td class="playready_la_url">{{stream.playready_la_url|default(drm.playready.laurl)}}</td>
      <td><button class="btn btn-danger btn-sm delete-stream" data-id="{{stream.key.urlsafe()}}">Delete</button></td>
    </tr>
    {% endfor %}
    <tr class="placeholder">
      <td class="title"></td>
      <td class="prefix">
      <td class="marlin_la_url"></td>
      <td class="playready_la_url"></td>
      <td><button class="btn btn-sm btn-danger delete-stream">Delete</button></td>
    </tr>
  </tbody>
  <tfoot>
    <tr>
      <td class="title"><input type="text" name="title" placeholder="(stream title)"/></td>
      <td class="prefix"><input type="text" name="prefix" placeholder="(file prefix)"/></td>
      <td class="marlin_la_url"><input type="text" name="marlin_la_url" placeholder="(SAS URL)"/></td>
      <td class="playready_la_url"><input type="text" name="playready_la_url" placeholder="(LA_URL)"/></td>
      <td><button class="btn btn-success add-stream">Add</button></td>
    </tr>
    <tr><td class="error" colspan="3"></td></tr>
    </tfoot>
</table>

  <table class="table table-striped" id="media-files" data-csrf="{{csrf_tokens.files}}">
    <caption>Media Files</caption>
  <thead>
    <tr>
      <th class="filename">Name</th>
      <th class="filesize">Size</th>
      <th class="created">Created</th>
      <th class="md5-hash">MD5</th>
      <th class="contentType">Type</th>
      <th class="codec">Codec</th>
      <th class="kid">KID</th>
      <th class="index"></th>
      <th class="delete"></th>
    </tr>
  </thead>
  <tbody>
    {% for media in files %}
    {% include "media_row.html" %}
    {% endfor %}
    <tr class="error-row"><td class="error" colspan="8"></td></tr>
  </tbody>
</table>

  <table class="table table-striped" id="keys" data-csrf="{{csrf_tokens.kids}}">
    <caption>Keys</caption>
  <thead><tr><th>KID</th><th>Key</th><th>Auto generated</th><th /></tr></thead>
  <tbody>
    {% for keypair in keys %}
    <tr>
      <td class="kid">{{keypair.KID.hex}}</td>
      <td class="key">{{keypair.KEY.hex}}</td>
      <td class="computed">
        {% if keypair.computed %}
        <span class="bool-yes %s">&check;</span>
        {% else %}
        <span class="bool-no ">&cross;</span>
        {% endif %}
      </td>
      <td><button class="btn btn-danger delete-key">Delete</button></td>
    </tr>
    {% endfor %}
    <tr class="placeholder"><td class="kid"></td><td class="key"></td><td class="computed"></td><td><button class="btn
    btn-danger delete-key">Delete</button></td></tr>
  </tbody>
  <tfoot>
    <tr>
      <td><input type="text" name="kid" /></td>
      <td><input type="text" name="key" placeholder="(autogenerated)"/></td>
      <td colspan="2"><button class="btn btn-success add-key">Add</button></td>
    </tr>
    <tr><td class="error" colspan="3"></td></tr>
    </tfoot>
  </table>
  <div class="form-container">
    {% include "upload_form.html" %}
  </div>
</div>

<div class="modal" tabIndex="-1" role="dialog" id="dialog-box">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title"></h5>
        <button type="button" class="close btn-close"
              data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary btn-close" data-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>
{% endblock %}

{% block scripts %}
  <div class="modal-backdrop hidden"></div>
  {{import_script("jquery-3.4.1")}}
  <script src="/js/media.js" type="text/javascript"></script>
{% endblock %}
